services:
  # https://github.com/felddy/foundryvtt-docker
  # scp -r "C:\Users\Davy\Downloads\cos\world.json" root@davydehaas.nl:/server/foundry-cos/Data/worlds/cor-cos
  foundry-cos:
    image: felddy/foundryvtt:12.331.0@sha256:306930efe642caa5541add4e269127a3a9122e007496bb22b524f7d9bcc755fc
    container_name: foundry-cos
    restart: unless-stopped
    cpus: 1
    mem_limit: 512m
    user: ${UID}:${GID}
    environment:
      - TZ=${TZ}
      - FOUNDRY_USERNAME=${FOUNDRY_USERNAME}
      - FOUNDRY_PASSWORD=${FOUNDRY_PASSWORD}
      - FOUNDRY_ADMIN_KEY=admin
      - CONTAINER_PRESERVE_CONFIG=true
      - CONTAINER_CACHE=${USER_DIR}/foundry-cos/data/container_cache
    volumes:
      - ${USER_DIR}/foundry-cos:/data
      - ${USER_DIR}/foundry-cos/resources/app:/home/foundry/resources/app
    expose:
      - 30000
    healthcheck:
      test: ["CMD", "curl", "--fail", "http://foundry-cos:30000"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
      start_interval: 5s
    labels:
      - diun.enable=true
      - traefik.enable=true
      - traefik.http.routers.foundry-cos.entrypoints=websecure
      - traefik.http.routers.foundry-cos.rule=Host(`foundry-cos.${DOMAIN_NAME}`)
      - traefik.http.routers.foundry-cos.middlewares=chain-no-auth@file
      - traefik.http.services.foundry-cos.loadbalancer.server.port=30000
    networks:
      - reverse-proxy
networks:
  reverse-proxy:
    external: true
    name: reverse-proxy_default
