version: "3.8"
services:
  # sudo chown -R 472:472 /server/grafana
  mailu:
    image: mailu/mailu:1.7
    container_name: mailu
    restart: unless-stopped
    cpus: 1
    mem_limit: 1G
    environment:
    - TZ=${TZ}
    - GF_USERS_ALLOW_SIGN_UP=false
    volumes:
    - /server/mailu:/var/lib/grafana
    expose:
    - 3000
    labels:
    - com.centurylinklabs.watchtower.enable=true
    - diun.enable=true
    - diun.watch_repo=true
    depends_on:
    - mailu-postgresql
  # PostgreSQL database used by Mailu
  mailu-postgresql:
    image: postgres:alpine
    container_name: mailu-postgresql
    restart: unless-stopped
    cpus: 1
    mem_limit: 1G
    environment:
    - PUID=${PUID}
    - PGID=${PGID}
    - TZ=${TZ}
    - POSTGRES_USER=mailu
    - POSTGRES_PASSWORD=mailu
    - POSTGRES_DB=mailu
    volumes:
    - /mnt/raid/server/mailu-postgresql:/var/lib/postgresql
    # This needs explicit mapping due to https://github.com/docker-library/postgres/blob/4e48e3228a30763913ece952c611e5e9b95c8759/Dockerfile.template#L52
    - /mnt/raid/server/mailu-postgresql/data:/var/lib/postgresql/data
    expose:
    - 5432
    labels:
    - com.centurylinklabs.watchtower.enable=true
    - diun.enable=true
    - diun.watch_repo=true
    shm_size: 256M