networks:
  reverse-proxy:
    external: true

services:
  cloudflare-companion:
    image: ghcr.io/tiredofit/docker-traefik-cloudflare-companion:7.4.0
    container_name: cloudflare-companion
    deploy:
      resources:
        limits:
          cpus: '0.01'
          memory: 256M
        reservations:
          cpus: '0.001'
          memory: 128M
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 3
        window: 60s
    networks:
      - reverse-proxy
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock:ro
    environment:
      TZ: ${TZ}
      TRAEFIK_VERSION: 2
      # Same as Traefik
      CF_EMAIL: ${CLOUDFLARE_EMAIL:?error}
      # Same as Traefik
      CF_TOKEN: ${CLOUDFLARE_API_KEY:?error}
      DEFAULT_TTL: 300
      TARGET_DOMAIN: ${DOMAIN_NAME}
      DOMAIN1: ${DOMAIN_NAME}
      DOMAIN1_ZONE_ID: ${CLOUDFLARE_ZONE_ID:?error}
      DOMAIN1_PROXIED: true
